var ke=Object.defineProperty,ge=Object.defineProperties;var me=Object.getOwnPropertyDescriptors;var x=Object.getOwnPropertySymbols;var J=Object.prototype.hasOwnProperty,G=Object.prototype.propertyIsEnumerable;var K=(e,t,s)=>t in e?ke(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s,c=(e,t)=>{for(var s in t||(t={}))J.call(t,s)&&K(e,s,t[s]);if(x)for(var s of x(t))G.call(t,s)&&K(e,s,t[s]);return e},f=(e,t)=>ge(e,me(t));var h=(e,t)=>{var s={};for(var a in e)J.call(e,a)&&t.indexOf(a)<0&&(s[a]=e[a]);if(e!=null&&x)for(var a of x(e))t.indexOf(a)<0&&G.call(e,a)&&(s[a]=e[a]);return s};import{c as F,a as z,b as W,n as X,d as p,_ as fe,e as H,h as Se,p as he,g as ye,D as ve,i as Ie,L as be,j as n,f as Y,R as y,k,l as v,m as Te,o as De,q as Ae,r as Re,F as xe,s as ze,P as $e,t as Ne,u as Ee,v as Pe,w as Ce,x as Q,N as Z,y as _e,z as ee,A as we,B as Fe,C as He,E as Oe}from"./vendor.e1d9cdb1.js";const je=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))a(r);new MutationObserver(r=>{for(const i of r)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&a(o)}).observe(document,{childList:!0,subtree:!0});function s(r){const i={};return r.integrity&&(i.integrity=r.integrity),r.referrerpolicy&&(i.referrerPolicy=r.referrerpolicy),r.crossorigin==="use-credentials"?i.credentials="include":r.crossorigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function a(r){if(r.ep)return;r.ep=!0;const i=s(r);fetch(r.href,i)}};je();const I=F("reset");F("set");const b=F("resolveDay"),$={pizza:"pizza"},te={points:0,special:{[$.pizza]:0}},Be={pizza:e=>e.points*.05},Le={extraReducers:{[I]:()=>te,[b]:(e,{payload:{bank:t}})=>{Object.entries(t).forEach(([s,a])=>{var r;s==="points"?e.points+=a:e.special[s]=((r=e.special[s])!=null?r:0)+a})}},initialState:te,name:"bank",reducers:{addPoints(e,{payload:t}){e.points+=t},addSpecial(e,{payload:{amount:t,type:s="pizza"}}){e.special[s]+=t},setPoints(e,{payload:t}){e.points=t},setSpecial(e,{payload:{amount:t,type:s="pizza"}}){e.special[s]=t},spendPoints(e,{payload:t}){t<=e.points&&(e.points-=t)},spendSpecial(e,{payload:{amount:t,type:s="pizza"}}){t<=e.special[s]&&(e.special[s]-=t)}}},Me=(e,t)=>{var s;return((s=e==null?void 0:e.bank)!=null?s:e).special[t]},Ve=e=>{var t;return((t=e==null?void 0:e.bank)!=null?t:e).special.pizza},qe=e=>{var t;return((t=e==null?void 0:e.bank)!=null?t:e).points},Ue=(e,t)=>Be[t](e),Je={getPizza:Ve,getPoints:qe,getSpecial:Me,getSpecialValue:Ue},se=z(Le);var Ge=se.reducer;const Ke=se.actions,We=e=>{const t=e.reduce((s,a)=>(s[a.id.replace(/ /g,"-")]=a,s),{});return{entities:t,ids:Object.keys(t)}},ae=e=>t=>(s,{payload:a})=>e.updateOne(s,{changes:t,id:a}),re=e=>t=>(s,{payload:a})=>e.updateOne(s,{changes:t(s.entities[a]),id:a}),u={active:"active",done:"done"};function O(e,t={}){return c({currentStreakIndex:1,id:X(),status:u.active,streakIterations:1,task:e},t)}const ne=6,T=W(),N="a",E="b";N+"",O(N,{id:N}),E+"",O(E,{id:E});const ie=We(["email","meditate","teeth","clean 5%","quirk","walk","dev tea","luminosity","\u{1F50A}\u{1F4DA} (20)","read(20)","track \u{1F96A}","track \u{1F964}","fiber \u{1F9FB}","#points"].map(e=>O(e,{id:e.replace(/ /g,"-")}))),j=ae(T),D=re(T);function oe(e){return e.currentStreakIndex===ne?{currentStreakIndex:1,streakIterations:e.streakIterations+1}:{currentStreakIndex:e.currentStreakIndex+1}}const ce=z({extraReducers:{[I]:(e,{payload:t})=>{var s;return T.getInitialState((s=t==null?void 0:t.streaks)!=null?s:ie)},[b]:(e,{payload:t})=>{t.tasks&&Object.values(e.entities).forEach(s=>{s.status===u.active?(s.streakIterations=1,s.currentStreakIndex=1):(s.status=u.active,D(oe)(e,{payload:s.id}))})}},initialState:T.getInitialState(ie),name:"streaks",reducers:{bumpStreak:D(oe),bumpStreakIndex:D(e=>({currentStreakIndex:e.currentStreakIndex+1})),bumpStreakIterations:D(e=>({streakIterations:e.streakIterations+1})),markTaskActive:j({status:u.active}),markTaskDone:j({status:u.done}),resetStreak:j({currentStreakIndex:1,status:u.active,streakIterations:1}),toggleTaskStatus:D(e=>({status:e.status===u.active?u.done:u.active}))}}),Xe=ce.reducer,le=ce.actions,d=T.getSelectors(e=>{var t;return(t=e==null?void 0:e.streaks)!=null?t:e});d.getStreak=d.selectById;d.getStreakIndex=p(d.getStreak,e=>e.currentStreakIndex);d.getStreakIteration=p(d.getStreak,e=>e.streakIterations);d.getStreakValue=p(d.getStreak,e=>e.status===u.active?0:e.currentStreakIndex===ne?$.pizza:e.currentStreakIndex*e.streakIterations);d.getDaysPoints=p([d.selectIds,e=>e],(e,t)=>e.map(s=>d.getStreakValue(t,s)).reduce((s,a)=>{var r;return Number.isInteger(a)?s.points+=a:s[$[a]]=((r=s==null?void 0:s[$[a]])!=null?r:0)+1,s},{points:0}));const Ye={active:"active",done:"done"};function P(e,t={}){return typeof e=="object"&&(t=e),c({id:X(),status:Ye.active,task:e,value:1},t)}const C="a",_="b";C+"",P(C,{id:C}),_+"",P(_,{id:_});const g={active:"active",done:"done"},m=W(),de=ae(m),Qe=re(m),B=z({extraReducers:{[I]:()=>m.getInitialState({history:{}}),[b]:(e,{payload:t})=>{t.tasks&&Object.values(e.entities).forEach(s=>{s.status===g.done&&(e.history[s.id]=!0,s.value=0)})}},initialState:m.getInitialState({history:{}}),name:"tasks",reducers:{createTask:(e,{payload:t})=>m.addOne(e,P(t)),createTasks:(e,{payload:t})=>m.addMany(e,t.map(s=>P(s))),markTaskActive:de({status:g.active}),markTaskDone:de({status:g.done}),restoreTask:(e,{payload:t})=>{e.history[t]=!1,m.updateOne(e,{changes:{status:g.active},id:t})},toggleTaskStatus:Qe(e=>({status:e.status===g.active?g.done:g.active}))}});B.getInitialState();const Ze=B.reducer,A=B.actions,l=m.getSelectors(e=>{var t;return(t=e==null?void 0:e.tasks)!=null?t:e});l.getTask=l.selectById;l.getValue=p(l.getTask,e=>e.value);l.getDaysPoints=p([l.selectIds,e=>e],(e,t)=>e.reduce((s,a)=>s+l.getValue(t,a),0));l.getHistory=p(e=>e.tasks,e=>e.history);l.getHistoricalTasks=p(l.selectAll,l.getHistory,(e,t)=>e.filter(s=>t[s.id]));l.getActiveTasks=p(l.selectAll,l.getHistory,(e,t)=>e.filter(s=>!t[s.id]));function et(e){try{JSON.parse(e)}catch{return!1}return isNaN(e)}const tt=(e="param")=>()=>{throw new Error(`${Array.isArray(e)?e[0]:e} is required`)},st=tt,at=e=>et(e)?JSON.parse(e):e,rt=e=>c(c({},{debug:!0,deserialize:at,key:"root",stateReconciler:fe,storage:H}),e);function nt(e,t=2e3){const s=he({interval:t,limit:1})(a=>ye(e,a).catch(console.error));return{deleteItem:s,getItem:()=>Se(e).then(a=>a.data()).then(console.tap).catch(console.error),setItem:s}}function it(e){Ie(e);const t=be();return ve(t,"state","state")}const ot=(e,t)=>{const s=it(e);return nt(s,t)},ct=e=>Object.entries(JSON.parse(e)).reduce((t,[s,a])=>f(c({},t),{[s]:JSON.parse(a)}),{}),lt=(e=st`firebaseConfig`,t=100)=>{const s=ot(e,t),a={deleteItem:(...r)=>H.deleteItem(...r).then(i=>(s.deleteItem(),i)),getItem:s.getItem,setItem:(r,i)=>H.setItem(r,i).then(()=>s.setItem(ct(i)))};return rt({storage:a})};var dt={apiKey:"AIzaSyD7U2xm2iJuhM6XOs4dGMtAmqlT6TWh1I0",appId:"1:72274275033:web:a9f21b39f1856ea326acc8",authDomain:"points-streaks.firebaseapp.com",messagingSenderId:"72274275033",projectId:"points-streaks",storageBucket:"points-streaks.appspot.com"};const ut=(e,t)=>Math.abs(e-t),pt=({streakIterations:e,currentStreakIndex:t})=>{const s=Array(5).fill(0).map((a,r)=>r+e).concat("\u{1F355}");return n("div",{className:"streak",children:s.map((a,r)=>n("span",{className:`point dist-${ut(t,r+1)}`,children:a},a))})},ue=({task:e,children:t,isDone:s})=>n("h3",{className:Y("name",{done:s}),children:t!=null?t:e}),kt=({value:e,children:t})=>n("code",{className:"value",children:t!=null?t:e}),L=a=>{var r=a,{children:e,toggleTaskStatus:t}=r,s=h(r,["children","toggleTaskStatus"]);let i=y.Children.toArray(e);return i.length?i.length===1&&i.unshift(ue):i=[ue,kt],k("div",{className:"task",onClick:t,children:[n("input",{type:"checkbox",readOnly:!0,checked:s.isDone}),i.map((o,V)=>{var q,U;const S=`${s.id}_${(U=(q=o==null?void 0:o.type)==null?void 0:q.name)!=null?U:o.type}_${V}`;return y.isValidElement(o)?y.cloneElement(o,f(c({},s),{key:S})):y.createElement(o,f(c({},s),{key:S}))})]})},gt=e=>n(L,f(c({},e),{children:n(pt,{})})),mt=v((e,{status:t})=>({isDone:t===u.done}),(e,{id:t})=>({toggleTaskStatus:()=>e(le.toggleTaskStatus(t))}))(gt);function R(e=new Date){return new Date(e).setHours(0,0,0,0)}function ft(e){return e.app.date===R()?{app:{},bank:{},streaks:!1,tasks:!1}:{app:{date:R()},bank:d.getDaysPoints(e),streaks:!0,tasks:!0}}const pe=z({extraReducers:{[I]:()=>({date:R()}),[b]:(e,{payload:t})=>{var s,a;e.date=(a=(s=t==null?void 0:t.app)==null?void 0:s.date)!=null?a:e.date}},initialState:{date:R()},name:"app",reducers:{setDate:(e,{payload:t})=>{e.date=R(t)}}});var St=pe.reducer;const ht=pe.actions,yt={},vt=lt(dt),It=c({key:"root",version:1},vt);c(c(c(c({reset:I},A),ht),Ke),le);const w={app:yt,bank:Je,streaks:d,tasks:l},bt=Te({app:St,bank:Ge,streaks:Xe,tasks:Ze}),Tt=De(It,bt),M=Ae({devTools:!0,middleware:e=>e({serializableCheck:{ignoredActions:[xe,ze,$e,Ne,Ee,Pe]}}),reducer:Tt});let Dt=Re(M);M.getState();const At=e=>t=>{t.preventDefault(),e(console.tap(t.target.elements.tasks.value.split(`
`),"from the input"))},Rt=({createTask:e,createTasks:t})=>k("form",{onSubmit:At(t),children:[n("textarea",{name:"tasks"}),n("button",{type:"submit",children:"Submit"})]}),xt=v(null,e=>({createTask:t=>e(A.createTask(t)),createTasks:t=>e(A.createTasks(t))}))(Rt),zt=e=>n(L,c({},e)),$t=v((e,{status:t})=>({isDone:t===g.done}),(e,{id:t})=>({toggleTaskStatus:()=>e(A.toggleTaskStatus(t))}))(zt),Nt=s=>{var a=s,{restoreTask:e}=a,t=h(a,["restoreTask"]);return n(L,f(c({},t),{children:n("button",{onClick:e,children:"Restore"})}))},Et=v((e,{status:t})=>({isDone:t===g.done}),(e,{id:t})=>({toggleTaskStatus:()=>{},restoreTask:()=>e(A.restoreTask(t))}))(Nt);function Pt(){return new URL(document.location).searchParams.get("debug")==="ui"}function Ct({streaks:e,tasks:t,lastRunDate:s,resolveDay:a,historicalTasks:r,activeTasks:i}){return Ce.exports.useEffect(()=>(Q.exports.startReportingRuntimeErrors({onError:()=>{}}),()=>Q.exports.stopReportingRuntimeErrors()),[]),k("div",{className:Y("App",{debug:Pt()}),children:[n(xt,{}),k("button",{onClick:()=>a(),children:["Resolve ",s]}),k("div",{id:"task-section",children:[n("div",{className:"task-list",children:e.map(o=>n(mt,c({},o),o.id))}),k("span",{children:[n(Z,{to:"active",activeClassName:"active",className:"task-list-link",children:"Active"}),n(Z,{to:"history",activeClassName:"active",className:"task-list-link",children:"History"})]}),k(_e,{children:[n(ee,{path:"/active",element:k("div",{className:"task-list",children:[n("h3",{children:"Active"}),i.map(o=>n($t,c({},o),o.id))]})}),n(ee,{path:"/history",element:k("div",{className:"task-list",children:[n("h3",{children:"History"}),r.map(o=>n(Et,c({},o),o.id))]})})]})]})]})}function _t(e){var t={weekday:"long",month:"long",day:"numeric"};return new Intl.DateTimeFormat("en-US",t).format(new Date(e))}var wt=v(e=>({state:e,lastRunDate:_t(e.app.date),streaks:w.streaks.selectAll(e),tasks:w.tasks.selectAll(e),activeTasks:w.tasks.getActiveTasks(e),historicalTasks:w.tasks.getHistoricalTasks(e)}),e=>({resolveDay:t=>()=>e(b(ft(t)))}),(i,V,r)=>{var o=i,{state:e}=o,t=h(o,["state"]);var S=V,{resolveDay:s}=S,a=h(S,["resolveDay"]);return f(c(c(c({},r),a),t),{resolveDay:s(e)})})(Ct);const Ft=({children:e})=>n(He,{store:M,children:n(Oe,{loading:null,persistor:Dt,children:e})});console.tap=(e,...t)=>(console.log(e,...t),e);we.render(n(y.StrictMode,{children:n(Fe,{children:n(Ft,{children:n(wt,{})})})}),document.getElementById("root"));
