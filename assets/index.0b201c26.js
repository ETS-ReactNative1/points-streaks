var ce=Object.defineProperty,le=Object.defineProperties;var de=Object.getOwnPropertyDescriptors;var T=Object.getOwnPropertySymbols;var q=Object.prototype.hasOwnProperty,J=Object.prototype.propertyIsEnumerable;var U=(e,t,s)=>t in e?ce(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s,o=(e,t)=>{for(var s in t||(t={}))q.call(t,s)&&U(e,s,t[s]);if(T)for(var s of T(t))J.call(t,s)&&U(e,s,t[s]);return e},g=(e,t)=>le(e,de(t));var D=(e,t)=>{var s={};for(var a in e)q.call(e,a)&&t.indexOf(a)<0&&(s[a]=e[a]);if(e!=null&&T)for(var a of T(e))t.indexOf(a)<0&&J.call(e,a)&&(s[a]=e[a]);return s};import{c as O,a as x,b as B,n as G,d as f,j as i,e as H,R as S,f as R,g as w,_ as ue,h as F,i as pe,p as ke,k as ge,D as fe,l as me,L as Se,m as Ie,o as he,q as ye,r as be,F as ve,s as Te,P as De,t as xe,u as Re,v as ze,w as Ae,x as K,y as Pe,z as $e,A as Ee}from"./vendor.e72b666d.js";const Ce=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))a(r);new MutationObserver(r=>{for(const n of r)if(n.type==="childList")for(const c of n.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&a(c)}).observe(document,{childList:!0,subtree:!0});function s(r){const n={};return r.integrity&&(n.integrity=r.integrity),r.referrerpolicy&&(n.referrerPolicy=r.referrerpolicy),r.crossorigin==="use-credentials"?n.credentials="include":r.crossorigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function a(r){if(r.ep)return;r.ep=!0;const n=s(r);fetch(r.href,n)}};Ce();const I=O("reset");O("set");const h=O("resolveDay"),z={pizza:"pizza"},W={points:0,special:{[z.pizza]:0}},Ne={pizza:e=>e.points*.05},Oe={name:"bank",initialState:W,reducers:{spendPoints(e,{payload:t}){t<=e.points&&(e.points-=t)},addPoints(e,{payload:t}){e.points+=t},setPoints(e,{payload:t}){e.points=t},spendSpecial(e,{payload:{amount:t,type:s="pizza"}}){t<=e.special[s]&&(e.special[s]-=t)},addSpecial(e,{payload:{amount:t,type:s="pizza"}}){e.special[s]+=t},setSpecial(e,{payload:{amount:t,type:s="pizza"}}){e.special[s]=t}},extraReducers:{[I]:()=>W,[h]:(e,{payload:{bank:t}})=>{Object.entries(t).forEach(([s,a])=>{var r;s==="points"?e.points+=a:e.special[s]=((r=e.special[s])!=null?r:0)+a})}}},we=(e,t)=>{var s;return((s=e==null?void 0:e.bank)!=null?s:e).special[t]},Fe=e=>{var t;return((t=e==null?void 0:e.bank)!=null?t:e).special.pizza},je=e=>{var t;return((t=e==null?void 0:e.bank)!=null?t:e).points},_e=(e,t)=>Ne[t](e),Le={getPizza:Fe,getSpecialValue:_e,getPoints:je,getSpecial:we},X=x(Oe);var Me=X.reducer;const Ve=X.actions,qe=e=>{const t=e.reduce((s,a)=>(s[a.id.replace(/ /g,"-")]=a,s),{});return{ids:Object.keys(t),entities:t}},Y=e=>t=>(s,{payload:a})=>e.updateOne(s,{id:a,changes:t}),Q=e=>t=>(s,{payload:a})=>e.updateOne(s,{id:a,changes:t(s.entities[a])}),d={active:"active",done:"done"};function j(e,t={}){return o({id:G(),status:d.active,task:e,streakIterations:1,currentStreakIndex:1},t)}const Z=6,y=B(),A="a",P="b";A+"",j(A,{id:A}),P+"",j(P,{id:P});const ee=qe(["email","meditate","teeth","clean 5%","quirk","walk","dev tea","luminosity","\u{1F50A}\u{1F4DA} (20)","read(20)","track \u{1F96A}","track \u{1F964}","fiber \u{1F9FB}","#points"].map(e=>j(e,{id:e.replace(/ /g,"-")}))),_=Y(y),b=Q(y);function te(e){return e.currentStreakIndex===Z?{streakIterations:e.streakIterations+1,currentStreakIndex:1}:{currentStreakIndex:e.currentStreakIndex+1}}const se=x({name:"streaks",initialState:y.getInitialState(ee),reducers:{toggleTaskStatus:b(e=>({status:e.status===d.active?d.done:d.active})),markTaskActive:_({status:d.active}),markTaskDone:_({status:d.done}),bumpStreakIterations:b(e=>({streakIterations:e.streakIterations+1})),bumpStreakIndex:b(e=>({currentStreakIndex:e.currentStreakIndex+1})),bumpStreak:b(te),resetStreak:_({status:d.active,streakIterations:1,currentStreakIndex:1})},extraReducers:{[I]:(e,{payload:t})=>{var s;return y.getInitialState((s=t==null?void 0:t.streaks)!=null?s:ee)},[h]:(e,{payload:t})=>{t.tasks&&Object.values(e.entities).forEach(s=>{s.status===d.active?(s.streakIterations=1,s.currentStreakIndex=1):(s.status=d.active,b(te)(e,{payload:s.id}))})}}}),Je=se.reducer,ae=se.actions,l=y.getSelectors(e=>{var t;return(t=e==null?void 0:e.streaks)!=null?t:e});l.getStreak=l.selectById;l.getStreakIndex=f(l.getStreak,e=>e.currentStreakIndex);l.getStreakIteration=f(l.getStreak,e=>e.streakIterations);l.getStreakValue=f(l.getStreak,e=>e.status===d.active?0:e.currentStreakIndex===Z?z.pizza:e.currentStreakIndex*e.streakIterations);l.getDaysPoints=f([l.selectIds,e=>e],(e,t)=>e.map(s=>l.getStreakValue(t,s)).reduce((s,a)=>{var r;return Number.isInteger(a)?s.points+=a:s[z[a]]=((r=s==null?void 0:s[z[a]])!=null?r:0)+1,s},{points:0}));const Ue={active:"active",done:"done"};function $(e,t={}){return typeof e=="object"&&(t=e),o({id:G(),status:Ue.active,task:e,value:1},t)}const E="a",C="b";E+"",$(E,{id:E}),C+"",$(C,{id:C});const k={active:"active",done:"done"},u=B(),re=Y(u),Be=Q(u),L=x({name:"tasks",initialState:u.getInitialState({completed:{}}),reducers:{createTasks:(e,{payload:t})=>u.addMany(e,t.map(s=>$(s))),createTask:(e,{payload:t})=>u.addOne(e,$(t)),toggleTaskStatus:Be(e=>({status:e.status===k.active?k.done:k.active})),markTaskActive:re({status:k.active}),markTaskDone:re({status:k.done}),restoreTask:(e,{payload:t})=>{e.history[t]=!1,u.updateOne(e,{id:t,changes:{status:k.active}})}},extraReducers:{[I]:()=>u.getInitialState({history:{}}),[h]:(e,{payload:t})=>{t.tasks&&Object.values(e.entities).forEach(s=>{s.status===k.done&&(e.history[s.id]=!0)})}}});L.getInitialState();const Ge=L.reducer,M=L.actions,p=u.getSelectors(e=>{var t;return(t=e==null?void 0:e.tasks)!=null?t:e});p.getTask=p.selectById;p.getValue=f(p.getTask,e=>e.value);p.getDaysPoints=f([p.selectIds,e=>e],(e,t)=>e.reduce((s,a)=>s+p.getValue(t,a),0));const He=(e,t)=>Math.abs(e-t),Ke=({streakIterations:e,currentStreakIndex:t})=>{const s=Array(5).fill(0).map((a,r)=>r+e).concat("\u{1F355}");return i("div",{className:"streak",children:s.map((a,r)=>i("span",{className:`point dist-${He(t,r+1)}`,children:a},a))})},ne=({task:e,children:t,isDone:s})=>i("h3",{className:H("name",{done:s}),children:t!=null?t:e}),We=({value:e,children:t})=>i("code",{className:"value",children:t!=null?t:e}),Xe=a=>{var r=a,{children:e,toggleTaskStatus:t}=r,s=D(r,["children","toggleTaskStatus"]);let n=S.Children.toArray(e);return n.length?n.length===1&&n.unshift(ne):n=[ne,We],R("div",{className:"task",onClick:t(s.id),children:[i("input",{type:"checkbox",readOnly:!0,checked:s.isDone}),n.map(c=>{var m;const N=s.id+"_"+((m=c==null?void 0:c.type)==null?void 0:m.name);return S.isValidElement(c)?S.cloneElement(c,g(o({},s),{key:N})):S.createElement(c,g(o({},s),{key:N}))})]})},Ye=e=>i(Xe,g(o({},e),{children:i(Ke,{})})),Qe=w((e,{status:t})=>({isDone:t===d.done}),e=>({toggleTaskStatus:t=>()=>e(ae.toggleTaskStatus(t))}))(Ye);function v(e=new Date){return new Date(e).setHours(0,0,0,0)}function Ze(e){return e.app.date===v()?{bank:{},streaks:!1,tasks:!1,app:{}}:{bank:l.getDaysPoints(e),tasks:!0,streaks:!0,app:{date:v()}}}const ie=x({name:"app",initialState:{date:v()},reducers:{setDate:(e,{payload:t})=>{e.date=v(t)}},extraReducers:{[I]:()=>({date:v()}),[h]:(e,{payload:t})=>{var s,a;e.date=(a=(s=t==null?void 0:t.app)==null?void 0:s.date)!=null?a:e.date}}});var et=ie.reducer;const tt=ie.actions,st={};function at(e){try{JSON.parse(e)}catch{return!1}return isNaN(e)}const rt=(e="param")=>()=>{throw new Error(`${Array.isArray(e)?e[0]:e} is required`)},nt=rt,it=e=>at(e)?JSON.parse(e):e,ot=e=>o(o({},{debug:!0,deserialize:it,key:"root",stateReconciler:ue,storage:F}),e);function ct(e,t=2e3){const s=ke({interval:t,limit:1})(a=>ge(e,a).catch(console.error));return{deleteItem:s,getItem:()=>pe(e).then(a=>a.data()).then(console.tap).catch(console.error),setItem:s}}function lt(e){me(e);const t=Se();return fe(t,"state","state")}const dt=(e,t)=>{const s=lt(e);return ct(s,t)},ut=e=>Object.entries(JSON.parse(e)).reduce((t,[s,a])=>g(o({},t),{[s]:JSON.parse(a)}),{}),pt=(e=nt`firebaseConfig`,t=100)=>{const s=dt(e,t),a={deleteItem:(...r)=>F.deleteItem(...r).then(n=>(s.deleteItem(),n)),getItem:s.getItem,setItem:(r,n)=>F.setItem(r,n).then(()=>s.setItem(ut(n)))};return ot({storage:a})};var kt={apiKey:"AIzaSyD7U2xm2iJuhM6XOs4dGMtAmqlT6TWh1I0",authDomain:"points-streaks.firebaseapp.com",projectId:"points-streaks",storageBucket:"points-streaks.appspot.com",messagingSenderId:"72274275033",appId:"1:72274275033:web:a9f21b39f1856ea326acc8"};const gt=pt(kt),ft=o({key:"root",version:1},gt);o(o(o(o({reset:I},M),tt),Ve),ae);const oe={tasks:p,streaks:l,app:st,bank:Le},mt=Ie({app:et,streaks:Je,bank:Me,tasks:Ge}),St=he(ft,mt),V=ye({reducer:St,middleware:e=>e({serializableCheck:{ignoredActions:[ve,Te,De,xe,Re,ze]}}),devTools:!0});let It=be(V);V.getState();const ht=e=>t=>{t.preventDefault(),e(console.tap(t.target.elements.tasks.value.split(`
`),"from the input"))},yt=({createTask:e,createTasks:t})=>R("form",{onSubmit:ht(t),children:[i("textarea",{name:"tasks"}),i("button",{type:"submit",children:"Submit"})]}),bt=w(null,e=>({createTask:t=>e(M.createTask(t)),createTasks:t=>e(M.createTasks(t))}))(yt);function vt(){return new URL(document.location).searchParams.get("debug")==="ui"}function Tt({streaks:e,tasks:t,lastRunDate:s,resolveDay:a}){return Ae.exports.useEffect(()=>(K.exports.startReportingRuntimeErrors({onError:()=>{}}),()=>K.exports.stopReportingRuntimeErrors()),[]),R("div",{className:H("App",{debug:vt()}),children:[i(bt,{}),i("div",{id:"task-streaks",children:e.map(r=>i(Qe,o({},r),r.id))}),R("button",{onClick:()=>a(),children:["Resolve ",s]}),i("pre",{children:i("code",{children:JSON.stringify(t,null,4)})})]})}function Dt(e){var t={weekday:"long",month:"long",day:"numeric"};return new Intl.DateTimeFormat("en-US",t).format(new Date(e))}var xt=w(e=>({state:e,lastRunDate:Dt(e.app.date),streaks:oe.streaks.selectAll(e),tasks:oe.tasks.selectAll(e)}),e=>({resolveDay:t=>()=>e(h(Ze(t)))}),(n,N,r)=>{var c=n,{state:e}=c,t=D(c,["state"]);var m=N,{resolveDay:s}=m,a=D(m,["resolveDay"]);return g(o(o(o({},r),a),t),{resolveDay:s(e)})})(Tt);const Rt=({children:e})=>i($e,{store:V,children:i(Ee,{loading:null,persistor:It,children:e})});console.tap=(e,...t)=>(console.log(e,...t),e);Pe.render(i(S.StrictMode,{children:i(Rt,{children:i(xt,{})})}),document.getElementById("root"));
