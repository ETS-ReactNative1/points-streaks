var ie=Object.defineProperty,oe=Object.defineProperties;var ce=Object.getOwnPropertyDescriptors;var x=Object.getOwnPropertySymbols;var V=Object.prototype.hasOwnProperty,q=Object.prototype.propertyIsEnumerable;var J=(e,t,s)=>t in e?ie(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s,i=(e,t)=>{for(var s in t||(t={}))V.call(t,s)&&J(e,s,t[s]);if(x)for(var s of x(t))q.call(t,s)&&J(e,s,t[s]);return e},g=(e,t)=>oe(e,ce(t));var D=(e,t)=>{var s={};for(var a in e)V.call(e,a)&&t.indexOf(a)<0&&(s[a]=e[a]);if(e!=null&&x)for(var a of x(e))t.indexOf(a)<0&&q.call(e,a)&&(s[a]=e[a]);return s};import{c as N,a as R,b as M,n as U,d as f,j as o,e as B,R as S,f as w,g as G,_ as de,h as O,i as le,p as ue,k as pe,D as ke,l as ge,L as fe,m as me,o as Se,q as Ie,r as he,F as ye,s as be,P as ve,t as xe,u as De,v as Re,w as Te,x as H,y as ze,z as $e,A as Ae}from"./vendor.6ff5783d.js";const Ee=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))a(r);new MutationObserver(r=>{for(const n of r)if(n.type==="childList")for(const c of n.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&a(c)}).observe(document,{childList:!0,subtree:!0});function s(r){const n={};return r.integrity&&(n.integrity=r.integrity),r.referrerpolicy&&(n.referrerPolicy=r.referrerpolicy),r.crossorigin==="use-credentials"?n.credentials="include":r.crossorigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function a(r){if(r.ep)return;r.ep=!0;const n=s(r);fetch(r.href,n)}};Ee();const I=N("reset");N("set");const h=N("resolveDay"),T={pizza:"pizza"},K={points:0,special:{[T.pizza]:0}},Pe={pizza:e=>e.points*.05},Ne={name:"bank",initialState:K,reducers:{spendPoints(e,{payload:t}){t<=e.points&&(e.points-=t)},addPoints(e,{payload:t}){e.points+=t},setPoints(e,{payload:t}){e.points=t},spendSpecial(e,{payload:{amount:t,type:s="pizza"}}){t<=e.special[s]&&(e.special[s]-=t)},addSpecial(e,{payload:{amount:t,type:s="pizza"}}){e.special[s]+=t},setSpecial(e,{payload:{amount:t,type:s="pizza"}}){e.special[s]=t}},extraReducers:{[I]:()=>K,[h]:(e,{payload:{bank:t}})=>{Object.entries(t).forEach(([s,a])=>{var r;s==="points"?e.points+=a:e.special[s]=((r=e.special[s])!=null?r:0)+a})}}},we=(e,t)=>{var s;return((s=e==null?void 0:e.bank)!=null?s:e).special[t]},Oe=e=>{var t;return((t=e==null?void 0:e.bank)!=null?t:e).special.pizza},Ce=e=>{var t;return((t=e==null?void 0:e.bank)!=null?t:e).points},je=(e,t)=>Pe[t](e),Fe={getPizza:Oe,getSpecialValue:je,getPoints:Ce,getSpecial:we},W=R(Ne);var _e=W.reducer;const Le=W.actions,Ve=e=>{const t=e.reduce((s,a)=>(s[a.id.replace(/ /g,"-")]=a,s),{});return{ids:Object.keys(t),entities:t}},X=e=>t=>(s,{payload:a})=>e.updateOne(s,{id:a,changes:t}),Y=e=>t=>(s,{payload:a})=>e.updateOne(s,{id:a,changes:t(s.entities[a])}),l={active:"active",done:"done"};function C(e,t={}){return i({id:U(),status:l.active,task:e,streakIterations:1,currentStreakIndex:1},t)}const Q=6,y=M(),z="a",$="b";z+"",C(z,{id:z}),$+"",C($,{id:$});const Z=Ve(["email","meditate","teeth","clean 5%","quirk","walk","dev tea","luminosity","\u{1F50A}\u{1F4DA} (20)","read(20)","track \u{1F96A}","track \u{1F964}","fiber \u{1F9FB}","#points"].map(e=>C(e,{id:e.replace(/ /g,"-")}))),j=X(y),b=Y(y);function ee(e){return e.currentStreakIndex===Q?{streakIterations:e.streakIterations+1,currentStreakIndex:1}:{currentStreakIndex:e.currentStreakIndex+1}}const te=R({name:"streaks",initialState:y.getInitialState(Z),reducers:{toggleTaskStatus:b(e=>({status:e.status===l.active?l.done:l.active})),markTaskActive:j({status:l.active}),markTaskDone:j({status:l.done}),bumpStreakIterations:b(e=>({streakIterations:e.streakIterations+1})),bumpStreakIndex:b(e=>({currentStreakIndex:e.currentStreakIndex+1})),bumpStreak:b(ee),resetStreak:j({status:l.active,streakIterations:1,currentStreakIndex:1})},extraReducers:{[I]:(e,{payload:t})=>{var s;return y.getInitialState((s=t==null?void 0:t.streaks)!=null?s:Z)},[h]:(e,{payload:t})=>{t.tasks&&Object.values(e.entities).forEach(s=>{s.status===l.active?(s.streakIterations=1,s.currentStreakIndex=1):(s.status=l.active,b(ee)(e,{payload:s.id}))})}}}),qe=te.reducer,se=te.actions,d=y.getSelectors(e=>{var t;return(t=e==null?void 0:e.streaks)!=null?t:e});d.getStreak=d.selectById;d.getStreakIndex=f(d.getStreak,e=>e.currentStreakIndex);d.getStreakIteration=f(d.getStreak,e=>e.streakIterations);d.getStreakValue=f(d.getStreak,e=>e.status===l.active?0:e.currentStreakIndex===Q?T.pizza:e.currentStreakIndex*e.streakIterations);d.getDaysPoints=f([d.selectIds,e=>e],(e,t)=>e.map(s=>d.getStreakValue(t,s)).reduce((s,a)=>{var r;return Number.isInteger(a)?s.points+=a:s[T[a]]=((r=s==null?void 0:s[T[a]])!=null?r:0)+1,s},{points:0}));function F(e,t={}){return typeof e=="object"&&(t=e),i({id:U(),status:status.active,task:e,value:1},t)}const A="a",E="b";A+"",F(A,{id:A}),E+"",F(E,{id:E});const p={active:"active",done:"done"},k=M(),ae=X(k),Je=Y(k),_=R({name:"tasks",initialState:k.getInitialState({completed:{}}),reducers:{createTask:(e,{payload:t})=>k.addOne(e,F(t)),toggleTaskStatus:Je(e=>({status:e.status===p.active?p.done:p.active})),markTaskActive:ae({status:p.active}),markTaskDone:ae({status:p.done}),restoreTask:(e,{payload:t})=>{e.history[t]=!1,k.updateOne(e,{id:t,changes:{status:p.active}})}},extraReducers:{[I]:()=>k.getInitialState({history:{}}),[h]:(e,{payload:t})=>{t.tasks&&Object.values(e.entities).forEach(s=>{s.status===p.done&&(e.history[s.id]=!0)})}}});_.getInitialState();const Me=_.reducer,Ue=_.actions,u=k.getSelectors(e=>{var t;return(t=e==null?void 0:e.tasks)!=null?t:e});u.getTask=u.selectById;u.getValue=f(u.getTask,e=>e.value);u.getDaysPoints=f([u.selectIds,e=>e],(e,t)=>e.reduce((s,a)=>s+u.getValue(t,a),0));const Be=(e,t)=>Math.abs(e-t),Ge=({streakIterations:e,currentStreakIndex:t})=>{const s=Array(5).fill(0).map((a,r)=>r+e).concat("\u{1F355}");return o("div",{className:"streak",children:s.map((a,r)=>o("span",{className:`point dist-${Be(t,r+1)}`,children:a},a))})},re=({task:e,children:t,isDone:s})=>o("h3",{className:B("name",{done:s}),children:t!=null?t:e}),He=({value:e,children:t})=>o("code",{className:"value",children:t!=null?t:e}),Ke=a=>{var r=a,{children:e,toggleTaskStatus:t}=r,s=D(r,["children","toggleTaskStatus"]);let n=S.Children.toArray(e);return n.length?n.length===1&&n.unshift(re):n=[re,He],w("div",{className:"task",onClick:t(s.id),children:[o("input",{type:"checkbox",readOnly:!0,checked:s.isDone}),n.map(c=>{var m;const P=s.id+"_"+((m=c==null?void 0:c.type)==null?void 0:m.name);return S.isValidElement(c)?S.cloneElement(c,g(i({},s),{key:P})):S.createElement(c,g(i({},s),{key:P}))})]})},We=e=>o(Ke,g(i({},e),{children:o(Ge,{})})),Xe=G((e,{status:t})=>({isDone:t===l.done}),e=>({toggleTaskStatus:t=>()=>e(se.toggleTaskStatus(t))}))(We);function v(e=new Date){return new Date(e).setHours(0,0,0,0)}function Ye(e){return e.app.date===v()?{bank:{},streaks:!1,tasks:!1,app:{}}:{bank:d.getDaysPoints(e),tasks:!0,streaks:!0,app:{date:v()}}}const ne=R({name:"app",initialState:{date:v()},reducers:{setDate:(e,{payload:t})=>{e.date=v(t)}},extraReducers:{[I]:()=>({date:v()}),[h]:(e,{payload:t})=>{var s,a;e.date=(a=(s=t==null?void 0:t.app)==null?void 0:s.date)!=null?a:e.date}}});var Qe=ne.reducer;const Ze=ne.actions,et={};function tt(e){try{JSON.parse(e)}catch{return!1}return isNaN(e)}const st=(e="param")=>()=>{throw new Error(`${Array.isArray(e)?e[0]:e} is required`)},at=st,rt=e=>tt(e)?JSON.parse(e):e,nt=e=>i(i({},{debug:!0,deserialize:rt,key:"root",stateReconciler:de,storage:O}),e);function it(e,t=2e3){const s=ue({interval:t,limit:1})(a=>pe(e,a).catch(console.error));return{deleteItem:s,getItem:()=>le(e).then(a=>a.data()).then(console.tap).catch(console.error),setItem:s}}function ot(e){ge(e);const t=fe();return ke(t,"state","state")}const ct=(e,t)=>{const s=ot(e);return it(s,t)},dt=e=>Object.entries(JSON.parse(e)).reduce((t,[s,a])=>g(i({},t),{[s]:JSON.parse(a)}),{}),lt=(e=at`firebaseConfig`,t=100)=>{const s=ct(e,t),a={deleteItem:(...r)=>O.deleteItem(...r).then(n=>(s.deleteItem(),n)),getItem:s.getItem,setItem:(r,n)=>O.setItem(r,n).then(()=>s.setItem(dt(n)))};return nt({storage:a})};var ut={apiKey:"AIzaSyD7U2xm2iJuhM6XOs4dGMtAmqlT6TWh1I0",authDomain:"points-streaks.firebaseapp.com",projectId:"points-streaks",storageBucket:"points-streaks.appspot.com",messagingSenderId:"72274275033",appId:"1:72274275033:web:a9f21b39f1856ea326acc8"};const pt=lt(ut),kt=i({key:"root",version:1},pt);i(i(i(i({reset:I},Ue),Ze),Le),se);const gt={tasks:u,streaks:d,app:et,bank:Fe},ft=me({app:Qe,streaks:qe,bank:_e,tasks:Me}),mt=Se(kt,ft),L=Ie({reducer:mt,middleware:e=>e({serializableCheck:{ignoredActions:[ye,be,ve,xe,De,Re]}}),devTools:!0});let St=he(L);L.getState();function It(){return new URL(document.location).searchParams.get("debug")==="ui"}function ht({tasks:e,lastRunDate:t,resolveDay:s}){return Te.exports.useEffect(()=>(H.exports.startReportingRuntimeErrors({onError:()=>{}}),()=>H.exports.stopReportingRuntimeErrors()),[]),w("div",{className:B("App",{debug:It()}),children:[o("div",{id:"task-streaks",children:e.map(a=>o(Xe,i({},a),a.id))}),w("button",{onClick:()=>s(),children:["Resolve ",t]}),o("pre",{children:o("code",{children:JSON.stringify(e,null,4)})})]})}function yt(e){var t={weekday:"long",month:"long",day:"numeric"};return new Intl.DateTimeFormat("en-US",t).format(new Date(e))}var bt=G(e=>({state:e,lastRunDate:yt(e.app.date),tasks:gt.streaks.selectAll(e)}),e=>({resolveDay:t=>()=>e(h(Ye(t)))}),(n,P,r)=>{var c=n,{state:e}=c,t=D(c,["state"]);var m=P,{resolveDay:s}=m,a=D(m,["resolveDay"]);return g(i(i(i({},r),a),t),{resolveDay:s(e)})})(ht);const vt=({children:e})=>o($e,{store:L,children:o(Ae,{loading:null,persistor:St,children:e})});console.tap=(e,...t)=>(console.log("%c"+new Error().stack.split(`
`)[2].replace(/    at ([^(]+).*src([^?]+)\?t=\d+:(\d+)/,"$1- $2:$3"),"background: tomato;color: #eee;padding: 5px;border-radius: 10px;margin: 5px",e,...t),e);ze.render(o(S.StrictMode,{children:o(vt,{children:o(bt,{})})}),document.getElementById("root"));
