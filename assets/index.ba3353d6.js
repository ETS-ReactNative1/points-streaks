var fe=Object.defineProperty,me=Object.defineProperties;var ye=Object.getOwnPropertyDescriptors;var x=Object.getOwnPropertySymbols;var J=Object.prototype.hasOwnProperty,G=Object.prototype.propertyIsEnumerable;var W=(e,t,s)=>t in e?fe(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s,c=(e,t)=>{for(var s in t||(t={}))J.call(t,s)&&W(e,s,t[s]);if(x)for(var s of x(t))G.call(t,s)&&W(e,s,t[s]);return e},m=(e,t)=>me(e,ye(t));var h=(e,t)=>{var s={};for(var a in e)J.call(e,a)&&t.indexOf(a)<0&&(s[a]=e[a]);if(e!=null&&x)for(var a of x(e))t.indexOf(a)<0&&G.call(e,a)&&(s[a]=e[a]);return s};import{j as i,c as K,R as S,a as p,b as _,d as $,e as X,n as Y,f as k,g as v,_ as he,h as O,i as Se,p as ve,k as Ie,D as be,l as Te,L as De,m as Ae,o as Re,q as xe,r as $e,F as ze,s as Ee,P as Pe,t as Ne,u as He,v as we,w as Ce,x as Q,N as Z,y as _e,z as ee,A as Oe,B as je,C as Fe,E as Be}from"./vendor.9d229de9.js";const Le=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))a(r);new MutationObserver(r=>{for(const o of r)if(o.type==="childList")for(const n of o.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&a(n)}).observe(document,{childList:!0,subtree:!0});function s(r){const o={};return r.integrity&&(o.integrity=r.integrity),r.referrerpolicy&&(o.referrerPolicy=r.referrerpolicy),r.crossorigin==="use-credentials"?o.credentials="include":r.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function a(r){if(r.ep)return;r.ep=!0;const o=s(r);fetch(r.href,o)}};Le();const Me=(e,t)=>Math.abs(e-t),Ve=({streakIterations:e,currentStreakIndex:t})=>{const s=Array(5).fill(0).map((a,r)=>r+e).concat("\u{1F355}");return i("div",{className:"streak",children:s.map((a,r)=>i("span",{className:`point dist-${Me(t,r+1)}`,children:a},a))})},te=({task:e,children:t,isDone:s})=>i("h3",{className:K("name",{done:s}),children:t!=null?t:e}),qe=({value:e,children:t})=>i("code",{className:"value",children:t!=null?t:e}),j=a=>{var r=a,{children:e,toggleTaskStatus:t}=r,s=h(r,["children","toggleTaskStatus"]);let o=S.Children.toArray(e);return o.length?o.length===1&&o.unshift(te):o=[te,qe],p("div",{className:"task",onClick:t,children:[i("input",{type:"checkbox",readOnly:!0,checked:s.isDone}),o.map((n,V)=>{var q,U;const y=`${s.id}_${(U=(q=n==null?void 0:n.type)==null?void 0:q.name)!=null?U:n.type}_${V}`;return S.isValidElement(n)?S.cloneElement(n,m(c({},s),{key:y})):S.createElement(n,m(c({},s),{key:y}))})]})},I=_("reset");_("set");const b=_("resolveDay"),z={pizza:"pizza"},se={points:0,special:{[z.pizza]:0}},Ue={pizza:e=>e.points*.05},Je={extraReducers:{[I]:()=>se,[b]:(e,{payload:{bank:t}})=>{Object.entries(t).forEach(([s,a])=>{var r;s==="points"?e.points+=a:e.special[s]=((r=e.special[s])!=null?r:0)+a})}},initialState:se,name:"bank",reducers:{addPoints(e,{payload:t}){e.points+=t},addSpecial(e,{payload:{amount:t,type:s="pizza"}}){e.special[s]+=t},setPoints(e,{payload:t}){e.points=t},setSpecial(e,{payload:{amount:t,type:s="pizza"}}){e.special[s]=t},spendPoints(e,{payload:t}){t<=e.points&&(e.points-=t)},spendSpecial(e,{payload:{amount:t,type:s="pizza"}}){t<=e.special[s]&&(e.special[s]-=t)}}},Ge=(e,t)=>{var s;return((s=e==null?void 0:e.bank)!=null?s:e).special[t]},We=e=>{var t;return((t=e==null?void 0:e.bank)!=null?t:e).special.pizza},Ke=e=>{var t;return((t=e==null?void 0:e.bank)!=null?t:e).points},Xe=(e,t)=>Ue[t](e),Ye={getPizza:We,getPoints:Ke,getSpecial:Ge,getSpecialValue:Xe},ae=$(Je);var Qe=ae.reducer;const Ze=ae.actions,et=e=>{const t=e.reduce((s,a)=>(s[a.id.replace(/ /g,"-")]=a,s),{});return{entities:t,ids:Object.keys(t)}},re=e=>t=>(s,{payload:a})=>e.updateOne(s,{changes:t,id:a}),ne=e=>t=>(s,a,...r)=>{var o,n;return e.updateOne(s,{changes:t(s.entities[(n=(o=a.payload)==null?void 0:o.id)!=null?n:a.payload],a,r),id:a.payload})},u={active:"active",done:"done"};function F(e,t={}){return c({currentStreakIndex:1,id:Y(),status:u.active,streakIterations:1,task:e},t)}const ie=6,T=X(),E="a",P="b";E+"",F(E,{id:E}),P+"",F(P,{id:P});const oe=et(["email","meditate","teeth","clean 5%","quirk","walk","dev tea","luminosity","\u{1F50A}\u{1F4DA} (20)","read(20)","track \u{1F96A}","track \u{1F964}","fiber \u{1F9FB}","#points"].map(e=>F(e,{id:e.replace(/ /g,"-")}))),B=re(T),D=ne(T);function ce(e){return e.currentStreakIndex===ie?{currentStreakIndex:1,streakIterations:e.streakIterations+1}:{currentStreakIndex:e.currentStreakIndex+1}}const le=$({extraReducers:{[I]:(e,{payload:t})=>{var s;return T.getInitialState((s=t==null?void 0:t.streaks)!=null?s:oe)},[b]:(e,{payload:t})=>{t.tasks&&Object.values(e.entities).forEach(s=>{s.status===u.active?(s.streakIterations=1,s.currentStreakIndex=1):(s.status=u.active,D(ce)(e,{payload:s.id}))})}},initialState:T.getInitialState(oe),name:"streaks",reducers:{bumpStreak:D(ce),bumpStreakIndex:D(e=>({currentStreakIndex:e.currentStreakIndex+1})),bumpStreakIterations:D(e=>({streakIterations:e.streakIterations+1})),markTaskActive:B({status:u.active}),markTaskDone:B({status:u.done}),resetStreak:B({currentStreakIndex:1,status:u.active,streakIterations:1}),toggleTaskStatus:D(e=>({status:e.status===u.active?u.done:u.active}))}}),tt=le.reducer,de=le.actions,d=T.getSelectors(e=>{var t;return(t=e==null?void 0:e.streaks)!=null?t:e});d.getStreak=d.selectById;d.getStreakIndex=k(d.getStreak,e=>e.currentStreakIndex);d.getStreakIteration=k(d.getStreak,e=>e.streakIterations);d.getStreakValue=k(d.getStreak,e=>e.status===u.active?0:e.currentStreakIndex===ie?z.pizza:e.currentStreakIndex*e.streakIterations);d.getDaysPoints=k([d.selectIds,e=>e],(e,t)=>e.map(s=>d.getStreakValue(t,s)).reduce((s,a)=>{var r;return Number.isInteger(a)?s.points+=a:s[z[a]]=((r=s==null?void 0:s[z[a]])!=null?r:0)+1,s},{points:0}));const st=e=>i(j,m(c({},e),{children:i(Ve,{})})),at=v((e,{status:t})=>({isDone:t===u.done}),(e,{id:t})=>({toggleTaskStatus:()=>e(de.toggleTaskStatus(t))}))(st),rt={active:"active",done:"done"};function N(e,t={}){return typeof e=="object"&&(t=e),c({history:[],id:Y(),status:rt.active,task:e,value:1},t)}const H="a",w="b";H+"",N(H,{id:H}),w+"",N(w,{id:w});const g={active:"active",done:"done"},f=X(),ue=re(f),pe=ne(f);function nt(e,t){var a,r;const s=(r=(a=t==null?void 0:t.payload)==null?void 0:a.id)!=null?r:t.payload;return typeof s=="string"&&s in e.entities?s:null}const it=pe((e,t)=>{e.history||(e.history=[]),e.history.push({action:t,date:Date.now()})}),ot=e=>(t,s)=>{const a=e(t,s);return nt(a,s)?it(a,s):a};function ke(e){return Object.fromEntries(Object.entries(e).map(([t,s])=>{const a=ot(s);return[t,a]}))}const L=$({extraReducers:ke({[I]:()=>f.getInitialState({history:{}}),[b]:(e,t)=>{const{payload:s}=t;s.tasks&&Object.values(e.entities).forEach(a=>{a.status===g.done&&(e.history[a.id]=!0,a.value=0,a.history.push({action:t,date:Date.now()}))})}}),initialState:f.getInitialState({history:{}}),name:"tasks",reducers:ke({createTask:(e,{payload:t})=>f.addOne(e,N(t)),createTasks:(e,{payload:t})=>f.addMany(e,t.map(s=>N(s))),markTaskActive:ue({status:g.active}),markTaskDone:ue({status:g.done}),restoreTask:(e,{payload:t})=>(e.history[t]=!1,f.updateOne(e,{changes:{status:g.active},id:t}),e),toggleTaskStatus:pe(e=>({status:e.status===g.active?g.done:g.active}))})});L.getInitialState();const ct=L.reducer,A=L.actions,l=f.getSelectors(e=>{var t;return(t=e==null?void 0:e.tasks)!=null?t:e});l.getTask=l.selectById;l.getValue=k(l.getTask,e=>e.value);l.getDaysPoints=k([l.selectIds,e=>e],(e,t)=>e.reduce((s,a)=>s+l.getValue(t,a),0));l.getHistory=k(e=>e.tasks,e=>e.history);l.getHistoricalTasks=k(l.selectAll,l.getHistory,(e,t)=>e.filter(s=>t[s.id]));l.getActiveTasks=k(l.selectAll,l.getHistory,(e,t)=>e.filter(s=>!t[s.id]));function lt(e){try{JSON.parse(e)}catch{return!1}return isNaN(e)}const dt=(e="param")=>()=>{throw new Error(`${Array.isArray(e)?e[0]:e} is required`)},ut=dt,pt=e=>lt(e)?JSON.parse(e):e,kt=e=>c(c({},{debug:!0,deserialize:pt,key:"root",stateReconciler:he,storage:O}),e);function gt(e,t=2e3){const s=ve({interval:t,limit:1})(a=>Ie(e,a).catch(console.error));return{deleteItem:s,getItem:()=>Se(e).then(a=>a.data()).then(console.tap).catch(console.error),setItem:s}}function ft(e){Te(e);const t=De();return be(t,"state","state")}const mt=(e,t)=>{const s=ft(e);return gt(s,t)},yt=e=>Object.entries(JSON.parse(e)).reduce((t,[s,a])=>m(c({},t),{[s]:JSON.parse(a)}),{}),ht=(e=ut`firebaseConfig`,t=100)=>{const s=mt(e,t),a={deleteItem:(...r)=>O.deleteItem(...r).then(o=>(s.deleteItem(),o)),getItem:s.getItem,setItem:(r,o)=>O.setItem(r,o).then(()=>s.setItem(yt(o)))};return kt({storage:a})},St={apiKey:"AIzaSyD7U2xm2iJuhM6XOs4dGMtAmqlT6TWh1I0",appId:"1:72274275033:web:a9f21b39f1856ea326acc8",authDomain:"points-streaks.firebaseapp.com",messagingSenderId:"72274275033",projectId:"points-streaks",storageBucket:"points-streaks.appspot.com"};function R(e=new Date){return new Date(e).setHours(0,0,0,0)}function vt(e){return e.app.date===R()?{app:{},bank:{},streaks:!1,tasks:!1}:{app:{date:R()},bank:d.getDaysPoints(e),streaks:!0,tasks:!0}}const ge=$({extraReducers:{[I]:()=>({date:R()}),[b]:(e,{payload:t})=>{var s,a;e.date=(a=(s=t==null?void 0:t.app)==null?void 0:s.date)!=null?a:e.date}},initialState:{date:R()},name:"app",reducers:{setDate:(e,{payload:t})=>{e.date=R(t)}}});var It=ge.reducer;const bt=ge.actions,Tt={},Dt=ht(St),At=c({key:"root",version:1},Dt);c(c(c(c({reset:I},A),bt),Ze),de);const C={app:Tt,bank:Ye,streaks:d,tasks:l},Rt=Ae({app:It,bank:Qe,streaks:tt,tasks:ct}),xt=Re(At,Rt),M=xe({devTools:!0,middleware:e=>e({serializableCheck:{ignoredActions:[ze,Ee,Pe,Ne,He,we]}}),reducer:xt});let $t=$e(M);M.getState();const zt=e=>t=>{t.preventDefault(),e(console.tap(t.target.elements.tasks.value.split(`
`),"from the input"))},Et=({createTask:e,createTasks:t})=>p("form",{onSubmit:zt(t),children:[i("textarea",{name:"tasks"}),i("button",{type:"submit",children:"Submit"})]}),Pt=v(null,e=>({createTask:t=>e(A.createTask(t)),createTasks:t=>e(A.createTasks(t))}))(Et),Nt=e=>i(j,c({},e)),Ht=v((e,{status:t})=>({isDone:t===g.done}),(e,{id:t})=>({toggleTaskStatus:()=>e(A.toggleTaskStatus(t))}))(Nt),wt=s=>{var a=s,{restoreTask:e}=a,t=h(a,["restoreTask"]);return i(j,m(c({},t),{children:i("button",{onClick:e,children:"Restore"})}))},Ct=v((e,{status:t})=>({isDone:t===g.done}),(e,{id:t})=>({toggleTaskStatus:()=>{},restoreTask:()=>e(A.restoreTask(t))}))(wt);function _t(){return new URL(document.location).searchParams.get("debug")==="ui"}function Ot({streaks:e,tasks:t,lastRunDate:s,resolveDay:a,historicalTasks:r,activeTasks:o}){return Ce.exports.useEffect(()=>(Q.exports.startReportingRuntimeErrors({onError:()=>{}}),()=>Q.exports.stopReportingRuntimeErrors()),[]),p("div",{className:K("App",{debug:_t()}),children:[i(Pt,{}),p("button",{onClick:()=>a(),children:["Resolve ",s]}),p("div",{id:"task-section",children:[i("div",{className:"task-list",children:e.map(n=>i(at,c({},n),n.id))}),p("span",{children:[i(Z,{to:"active",className:({isActive:n})=>`task-list-link ${n?"active":""}`,children:"Active"}),i(Z,{to:"history",className:({isActive:n})=>`task-list-link ${n?"active":""}`,children:"History"})]}),p(_e,{children:[i(ee,{path:"/active",element:p("div",{className:"task-list",children:[i("h3",{children:"Active"}),o.map(n=>i(Ht,c({},n),n.id))]})}),i(ee,{path:"/history",element:p("div",{className:"task-list",children:[i("h3",{children:"History"}),r.map(n=>i(Ct,c({},n),n.id))]})})]})]})]})}function jt(e){var t={day:"numeric",month:"long",weekday:"long"};return new Intl.DateTimeFormat("en-US",t).format(new Date(e))}var Ft=v(e=>({activeTasks:C.tasks.getActiveTasks(e),historicalTasks:C.tasks.getHistoricalTasks(e),lastRunDate:jt(e.app.date),state:e,streaks:C.streaks.selectAll(e),tasks:C.tasks.selectAll(e)}),e=>({resolveDay:t=>()=>e(b(vt(t)))}),(o,V,r)=>{var n=o,{state:e}=n,t=h(n,["state"]);var y=V,{resolveDay:s}=y,a=h(y,["resolveDay"]);return m(c(c(c({},r),a),t),{resolveDay:s(e)})})(Ot);const Bt=({children:e})=>i(Fe,{store:M,children:i(Be,{loading:null,persistor:$t,children:e})});console.tap=(e,...t)=>(console.log(e,...t),e);Oe.render(i(S.StrictMode,{children:i(je,{children:i(Bt,{children:i(Ft,{})})})}),document.getElementById("root"));
